{% extends 'main/base.html' %} {% block title %}Admin Dashboard - InnovateTech
Solutions{% endblock %} {% block content %}
<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header mb-4" data-aos="fade-down">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="display-5 fw-bold text-dark mb-2">
          <i class="fas fa-tachometer-alt me-3 text-primary"></i>Admin Dashboard
        </h1>
        <p class="text-muted">
          Manage products, inquiries, messages, and branches
        </p>
      </div>
      <div class="col-md-4 text-md-end">
        <div class="d-flex flex-wrap gap-2 justify-content-md-end">
          <button
            class="btn btn-primary-modern btn-modern"
            data-bs-toggle="modal"
            data-bs-target="#addProductModal"
          >
            <i class="fas fa-plus me-2"></i>Add Product
          </button>
          <button
            class="btn btn-success-modern btn-modern"
            data-bs-toggle="modal"
            data-bs-target="#addBranchModal"
          >
            <i class="fas fa-map-marker-alt me-2"></i>Add Branch
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row g-4 mb-5">
    <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
      <div class="stats-card bg-primary text-white">
        <div class="stats-icon">
          <i class="fas fa-box"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ products|length }}</h3>
          <p class="stats-label">Total Products</p>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
      <div class="stats-card bg-success text-white">
        <div class="stats-icon">
          <i class="fas fa-question-circle"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ inquiries|length }}</h3>
          <p class="stats-label">Product Inquiries</p>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="300">
      <div class="stats-card bg-warning text-white">
        <div class="stats-icon">
          <i class="fas fa-envelope"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ messages|length }}</h3>
          <p class="stats-label">Messages</p>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="400">
      <div class="stats-card bg-info text-white">
        <div class="stats-icon">
          <i class="fas fa-code-branch"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ branches|length }}</h3>
          <p class="stats-label">Branches</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Section -->
  <div class="dashboard-section mb-5" data-aos="fade-up">
    <div
      class="section-header d-flex justify-content-between align-items-center mb-4"
    >
      <h3 class="section-title">
        <i class="fas fa-box me-2 text-primary"></i>Products
      </h3>
      <button
        class="btn btn-primary-modern btn-sm"
        data-bs-toggle="modal"
        data-bs-target="#addProductModal"
      >
        <i class="fas fa-plus me-1"></i>Add Product
      </button>
    </div>
    <div class="modern-card">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Product</th>
              <th>Image</th>
              <th>Available</th>
              <th>Price</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for product in products %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div class="product-info">
                    <h6 class="mb-0 fw-semibold">{{ product.name }}</h6>
                    <small class="text-muted"
                      >{{ product.description|truncatewords:10 }}</small
                    >
                  </div>
                </div>
              </td>
              <td>
                {% if product.image %}
                <img
                  src="{{ product.image.url }}"
                  alt="{{ product.name }}"
                  class="product-thumbnail"
                />
                {% else %}
                <div class="no-image-placeholder">
                  <i class="fas fa-image text-muted"></i>
                </div>
                {% endif %}
              </td>
              <td>
                <span
                  class="badge {% if product.quantity_available > 10 %}bg-success{% else %}bg-warning{% endif %}"
                >
                  {{ product.quantity_available }}
                </span>
              </td>
              <td>
                <span class="fw-semibold text-primary"
                  >${{ product.price|default:"0.00" }}</span
                >
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button
                    type="button"
                    class="btn btn-outline-primary edit-product-btn"
                    title="Edit"
                    data-product-id="{{ product.id }}"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-danger delete-product-btn"
                    title="Delete"
                    data-product-id="{{ product.id }}"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center py-4">
                <i class="fas fa-box-open fa-2x text-muted mb-2"></i>
                <p class="text-muted mb-0">No products available</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Inquiries Section -->
  <div class="dashboard-section mb-5" data-aos="fade-up" data-aos-delay="100">
    <div class="section-header mb-4">
      <h3 class="section-title">
        <i class="fas fa-question-circle me-2 text-success"></i>Product
        Inquiries
      </h3>
    </div>
    <div class="modern-card">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>User</th>
              <th>Product</th>
              <th>Quantity</th>
              <th>Address</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for inquiry in inquiries %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div
                    class="user-avatar bg-primary text-white rounded-circle me-2"
                  >
                    {{ inquiry.user.username|first|upper }}
                  </div>
                  <span class="fw-semibold">{{ inquiry.user.username }}</span>
                </div>
              </td>
              <td>{{ inquiry.product.name }}</td>
              <td>
                <span class="badge bg-primary">{{ inquiry.quantity }}</span>
              </td>
              <td>
                <span
                  class="text-truncate d-inline-block"
                  style="max-width: 150px"
                  title="{{ inquiry.address }}"
                  >{{ inquiry.address }}</span
                >
              </td>
              <td>
                <small class="text-muted"
                  >{{ inquiry.created_at|date:"M d, Y" }}</small
                >
              </td>
              <td>
                <span class="badge bg-warning">Pending</span>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-4">
                <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                <p class="text-muted mb-0">No inquiries yet</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Messages Section -->
  <div class="dashboard-section mb-5" data-aos="fade-up" data-aos-delay="200">
    <div class="section-header mb-4">
      <h3 class="section-title">
        <i class="fas fa-envelope me-2 text-warning"></i>Messages
      </h3>
    </div>
    <div class="modern-card">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Email</th>
              <th>Message</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for message in messages %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div
                    class="user-avatar bg-info text-white rounded-circle me-2"
                  >
                    {{ message.email|first|upper }}
                  </div>
                  <span class="fw-semibold">{{ message.email }}</span>
                </div>
              </td>
              <td>
                <span
                  class="text-truncate d-inline-block"
                  style="max-width: 200px"
                  title="{{ message.message }}"
                  >{{ message.message }}</span
                >
              </td>
              <td>
                <small class="text-muted"
                  >{{ message.created_at|date:"M d, Y" }}</small
                >
              </td>
              <td>
                <button class="btn btn-outline-primary btn-sm" title="View">
                  <i class="fas fa-eye"></i>
                </button>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center py-4">
                <i class="fas fa-comments fa-2x text-muted mb-2"></i>
                <p class="text-muted mb-0">No messages yet</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Branches Section -->
  <div class="dashboard-section mb-5" data-aos="fade-up" data-aos-delay="300">
    <div
      class="section-header d-flex justify-content-between align-items-center mb-4"
    >
      <h3 class="section-title">
        <i class="fas fa-code-branch me-2 text-info"></i>Branches
      </h3>
      <button
        class="btn btn-success-modern btn-sm"
        data-bs-toggle="modal"
        data-bs-target="#addBranchModal"
      >
        <i class="fas fa-plus me-1"></i>Add Branch
      </button>
    </div>
    <div class="modern-card">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Address</th>
              <th>Coordinates</th>
              <th>Primary</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for branch in branches %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <i class="fas fa-map-marker-alt text-danger me-2"></i>
                  <span class="fw-semibold">{{ branch.name }}</span>
                </div>
              </td>
              <td>
                <span
                  class="text-truncate d-inline-block"
                  style="max-width: 200px"
                  title="{{ branch.address }}"
                  >{{ branch.address }}</span
                >
              </td>
              <td>
                <!-- prettier-ignore -->
                <small class="text-muted">
                  {% if branch.latitude is not None %}
                    {{ branch.latitude|floatformat:2 }}
                  {% else %}
                    Not Set
                  {% endif %},
                  {% if branch.longitude is not None %}
                    {{ branch.longitude|floatformat:2 }}
                  {% else %}
                    Not Set
                  {% endif %}
                </small>
              </td>
              <td>
                {% if branch.primery_branch %}
                <span class="badge bg-success">Yes</span>
                {% else %}
                <span class="badge bg-secondary">No</span>
                {% endif %}
              </td>

              <td>
                <div class="btn-group btn-group-sm">
                  <button
                    class="btn btn-outline-primary edit-branch-btn"
                    title="Edit"
                    data-branch-id="{{ branch.id }}"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="btn btn-outline-danger delete-branch-btn"
                    title="Delete"
                    data-branch-id="{{ branch.id }}"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center py-4">
                <i class="fas fa-store-alt fa-2x text-muted mb-2"></i>
                <p class="text-muted mb-0">No branches added yet</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- edit Product Modal -->
<!-- Edit Product Modal -->
<div
  class="modal fade"
  id="productModal"
  tabindex="-1"
  aria-labelledby="productModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content modern-modal">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="productModalLabel">
          <i class="fas fa-edit me-2"></i>Edit Product
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <div class="modal-body p-4">
        <form id="productForm">
          <input type="hidden" id="productIdField" />

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  id="productName-E"
                  name="name"
                  class="form-control"
                  placeholder="Product Name"
                  required
                />
                <label for="productName-E">Product Name</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  id="productPrice-E"
                  name="price"
                  class="form-control"
                  placeholder="Price"
                />
                <label for="productPrice-E">Price ($)</label>
              </div>
            </div>

            <div class="col-12">
              <div class="form-floating">
                <textarea
                  id="productDescription-E"
                  name="description"
                  class="form-control"
                  placeholder="Description"
                  style="height: 100px"
                ></textarea>
                <label for="productDescription-E">Description</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating mb-3">
                <input
                  type="number"
                  id="productQuantity-E"
                  name="quantity_available"
                  class="form-control"
                  placeholder="Quantity Available"
                />
                <label for="productQuantity-E">Quantity Available</label>
              </div>

              <div class="mb-2">
                <div class="form-check">
                  <input
                    type="checkbox"
                    id="showPrice-E"
                    name="showPrice"
                    class="form-check-input"
                  />
                  <label class="form-check-label" for="showPrice-E">
                    Show Price
                  </label>
                </div>
              </div>

              <div class="mb-2">
                <div class="form-check">
                  <input
                    type="checkbox"
                    id="showQuantity-E"
                    name="showQuantity"
                    class="form-check-input"
                  />
                  <label class="form-check-label" for="showQuantity-E">
                    Show Quantity
                  </label>
                </div>
              </div>

              <div class="mb-2">
                <div class="form-check">
                  <input
                    type="checkbox"
                    id="placeOrders-E"
                    name="placeOrders"
                    class="form-check-input"
                  />
                  <label class="form-check-label" for="placeOrders-E">
                    Place Orders
                  </label>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="productImage-E" class="form-label fw-semibold">
                  Product Image
                </label>
                <input
                  type="file"
                  id="productImage-E"
                  name="image"
                  class="form-control"
                  accept="image/*"
                />
                <div class="form-text">Upload a product image (optional)</div>

                <img
                  id="productImagePreview"
                  src=""
                  alt=""
                  class="mt-3 img-fluid d-none rounded border"
                />
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button type="submit" form="productForm" class="btn btn-primary-modern">
          <i class="fas fa-save me-2"></i>Save changes
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add Product Modal -->
<div
  class="modal fade"
  id="addProductModal"
  tabindex="-1"
  data-bs-backdrop="static"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content modern-modal">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="fas fa-plus-circle me-2"></i>Add New Product
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body p-4">
        <form id="productForm2">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="productName"
                  name="name"
                  placeholder="Product Name"
                  required
                />
                <label for="productName">Product Name</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="productPrice"
                  name="price"
                  placeholder="Price"
                  step="0.01"
                />
                <label for="productPrice">Price ($)</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <textarea
                  class="form-control"
                  id="productDescription"
                  name="description"
                  placeholder="Description"
                  style="height: 100px"
                  required
                ></textarea>
                <label for="productDescription">Description</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating mb-3">
                <input
                  type="number"
                  class="form-control"
                  id="productQuantity"
                  name="quantity_available"
                  placeholder="Quantity Available"
                  required
                />
                <label for="productQuantity">Quantity Available</label>
              </div>
              <div class="mb-3">
                <label class="form-label" for="showPrice-E">Show Price</label>
                <input
                  type="checkbox"
                  id="showPrice"
                  name="showPrice"
                  class="form-check-input"
                />
              </div>
              <div class="mb-3">
                <label class="form-label" for="showQuantity-E"
                  >Show Quantity</label
                >
                <input
                  type="checkbox"
                  id="showQuantity"
                  name="showQuantity"
                  class="form-check-input"
                />
              </div>
              <div class="mb-3">
                <label class="form-label" for="showPrice-E">Place Orders</label>
                <input
                  type="checkbox"
                  id="placeOrders"
                  name="placeOrders"
                  class="form-check-input"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="productImage" class="form-label fw-semibold"
                  >Product Image</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="productImage"
                  name="image"
                  accept="image/*"
                />
                <div class="form-text">Upload a product image (optional)</div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary-modern"
          onclick="createProduct()"
          id="createProductBtn"
        >
          <i class="fas fa-plus me-2"></i>Add Product
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Branch Modal -->
<div
  class="modal fade"
  id="branchEditModal"
  tabindex="-1"
  aria-labelledby="branchEditModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content modern-modal">
      <form id="branchEditForm">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="branchEditModalLabel">
            <i class="fas fa-edit me-2"></i>Edit Branch
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body p-4">
          <input type="hidden" id="branchIdField" />

          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchName-E"
                  name="name"
                  placeholder="Branch Name"
                  required
                />
                <label for="branchName-E">Branch Name</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchPhone-E"
                  name="phone_number"
                  placeholder="Phone Number"
                />
                <label for="branchPhone-E">Phone Number</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="email"
                  class="form-control"
                  id="branchEmail-E"
                  name="Email_Adress"
                  placeholder="Email Address"
                />
                <label for="branchEmail-E">Email Address</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <textarea
                  class="form-control"
                  id="branchAddress-E"
                  name="address"
                  placeholder="Address"
                  style="height: 80px"
                ></textarea>
                <label for="branchAddress-E">Address</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="any"
                  class="form-control"
                  id="branchLatitude-E"
                  name="latitude"
                  placeholder="Latitude"
                />
                <label for="branchLatitude-E">Latitude</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="any"
                  class="form-control"
                  id="branchLongitude-E"
                  name="longitude"
                  placeholder="Longitude"
                />
                <label for="branchLongitude-E">Longitude</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchOpening-E"
                  name="opening_hours"
                  placeholder="Opening Hours"
                />
                <label for="branchOpening-E">Opening Hours</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchClosing-E"
                  name="closing_hours"
                  placeholder="Closing Hours"
                />
                <label for="branchClosing-E">Closing Hours</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchDayFrom-E"
                  name="day_from"
                  placeholder="Day From"
                />
                <label for="branchDayFrom-E">Day From</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchDayTo-E"
                  name="day_to"
                  placeholder="Day To"
                />
                <label for="branchDayTo-E">Day To</label>
              </div>
            </div>
            <!-- Social Links -->
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  id="branchFacebook-E"
                  name="facbook_link"
                  placeholder="Facebook Link"
                />
                <label for="branchFacebook-E">Facebook Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  id="branchInstagram-E"
                  name="instagram_link"
                  placeholder="Instagram Link"
                />
                <label for="branchInstagram-E">Instagram Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  id="branchTwitter-E"
                  name="twitter_link"
                  placeholder="Twitter Link"
                />
                <label for="branchTwitter-E">Twitter Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  id="branchLinkedin-E"
                  name="linkdin_link"
                  placeholder="LinkedIn Link"
                />
                <label for="branchLinkedin-E">LinkedIn Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-check mt-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="primery_branch"
                  id="primeryBranch-E"
                />
                <label class="form-check-label" for="primeryBranch-E">
                  Primary Branch
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-success-modern">
            <i class="fas fa-save me-2"></i>Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Branch Modal -->
<div
  class="modal fade"
  id="addBranchModal"
  tabindex="-1"
  data-bs-backdrop="static"
>
  <div class="modal-dialog">
    <div class="modal-content modern-modal">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">
          <i class="fas fa-map-marker-alt me-2"></i>Add New Branch
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body p-4">
        <form id="branchForm">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchName"
                  name="name"
                  placeholder="Branch Name"
                />
                <label for="branchName">Branch Name</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchPhone"
                  name="phone_number"
                  placeholder="Phone Number"
                />
                <label for="branchPhone">Phone Number</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="email"
                  class="form-control"
                  id="branchEmail"
                  name="Email_Adress"
                  placeholder="Email Address"
                />
                <label for="branchEmail">Email Address</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <textarea
                  class="form-control"
                  id="branchAddress"
                  name="address"
                  placeholder="Address"
                  style="height: 80px"
                ></textarea>
                <label for="branchAddress">Address</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="any"
                  class="form-control"
                  id="branchLatitude"
                  name="latitude"
                  placeholder="Latitude"
                />
                <label for="branchLatitude">Latitude</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="any"
                  class="form-control"
                  id="branchLongitude"
                  name="longitude"
                  placeholder="Longitude"
                />
                <label for="branchLongitude">Longitude</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchOpening"
                  name="opening_hours"
                  placeholder="Opening Hours"
                />
                <label for="branchOpening">Opening Hours</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchClosing"
                  name="closing_hours"
                  placeholder="Closing Hours"
                />
                <label for="branchClosing">Closing Hours</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchDayFrom"
                  name="day_from"
                  placeholder="Day From"
                />
                <label for="branchDayFrom">Day From</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="branchDayTo"
                  name="day_to"
                  placeholder="Day To"
                />
                <label for="branchDayTo">Day To</label>
              </div>
            </div>
            <!-- Social Links -->
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  name="facbook_link"
                  placeholder="Facebook Link"
                />
                <label>Facebook Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  name="instagram_link"
                  placeholder="Instagram Link"
                />
                <label>Instagram Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  name="twitter_link"
                  placeholder="Twitter Link"
                />
                <label>Twitter Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  name="linkdin_link"
                  placeholder="LinkedIn Link"
                />
                <label>LinkedIn Link</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-check mt-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="primery_branch"
                  id="primeryBranch"
                />
                <label class="form-check-label" for="primeryBranch">
                  Primary Branch
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-success-modern"
          onclick="createBranch()"
          id="createBranchBtn"
        >
          <i class="fas fa-plus me-2"></i>Add Branch
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // ================== CSRF & FETCH HELPERS ==================

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + "=")) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const CSRF_TOKEN = getCookie("csrftoken");

  async function apiRequest(
    url,
    { method = "GET", body = null, isForm = false } = {}
  ) {
    const options = {
      method,
      headers: {
        "X-CSRFToken": CSRF_TOKEN,
      },
    };

    if (body) {
      if (isForm) {
        options.body = body;
      } else {
        options.headers["Content-Type"] = "application/json";
        options.body = JSON.stringify(body);
      }
    }

    const response = await fetch(url, options);

    // Try to parse JSON always (for DRF-style APIs)
    let data;
    try {
      data = await response.json();
    } catch (e) {
      data = null;
    }

    if (!response.ok) {
      const msg =
        (data && (data.detail || data.error || JSON.stringify(data))) ||
        `HTTP ${response.status}`;
      throw new Error(msg);
    }

    return data;
  }

  function setButtonLoading(btn, isLoading, loadingText = "Saving...") {
    if (!btn) return;
    if (isLoading) {
      btn.dataset.originalText = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = `<div class="loading-spinner me-2"></div>${loadingText}`;
    } else {
      btn.disabled = false;
      btn.innerHTML = btn.dataset.originalText || btn.innerHTML;
    }
  }

  // Small helper for success then reload
  function successThenReload(modalInstance) {
    if (modalInstance) modalInstance.hide();
    setTimeout(() => window.location.reload(), 500);
  }

  // ================== DASHBOARD MODULE ==================
  const Dashboard = {
    init() {
      this.cacheDom();
      this.bindEvents();
    },

    // ---------- Cache all DOM elements ----------
    cacheDom() {
      // Product create
      this.productFormCreate = document.getElementById("productForm2");
      this.productCreateBtn = document.getElementById("createProductBtn");
      this.addProductModalEl = document.getElementById("addProductModal");
      this.addProductModal = this.addProductModalEl
        ? new bootstrap.Modal(this.addProductModalEl)
        : null;

      // Product edit
      this.productModalEl = document.getElementById("productModal");
      this.productModal = this.productModalEl
        ? new bootstrap.Modal(this.productModalEl)
        : null;
      this.productFormEdit = document.getElementById("productForm");
      this.productIdField = document.getElementById("productIdField");
      this.productNameE = document.getElementById("productName-E");
      this.productDescE = document.getElementById("productDescription-E");
      this.productQtyE = document.getElementById("productQuantity-E");
      this.productPriceE = document.getElementById("productPrice-E");
      this.productImagePreview = document.getElementById("productImagePreview");
      this.showPriceE = document.getElementById("showPrice-E");
      this.showQuantityE = document.getElementById("showQuantity-E");
      this.placeOrdersE = document.getElementById("placeOrders-E");

      // Branch create
      this.branchFormCreate = document.getElementById("branchForm");
      this.branchCreateBtn = document.getElementById("createBranchBtn");
      this.addBranchModalEl = document.getElementById("addBranchModal");
      this.addBranchModal = this.addBranchModalEl
        ? new bootstrap.Modal(this.addBranchModalEl)
        : null;

      // Branch edit
      this.branchEditModalEl = document.getElementById("branchEditModal");
      this.branchEditModal = this.branchEditModalEl
        ? new bootstrap.Modal(this.branchEditModalEl)
        : null;
      this.branchEditForm = document.getElementById("branchEditForm");
      this.branchIdField = document.getElementById("branchIdField");
      this.branchNameE = document.getElementById("branchName-E");
      this.branchPhoneE = document.getElementById("branchPhone-E");
      this.branchEmailE = document.getElementById("branchEmail-E");
      this.branchAddressE = document.getElementById("branchAddress-E");
      this.branchLatitudeE = document.getElementById("branchLatitude-E");
      this.branchLongitudeE = document.getElementById("branchLongitude-E");
      this.branchOpeningE = document.getElementById("branchOpening-E");
      this.branchClosingE = document.getElementById("branchClosing-E");
      this.branchDayFromE = document.getElementById("branchDayFrom-E");
      this.branchDayToE = document.getElementById("branchDayTo-E");
      this.branchFacebookE = document.getElementById("branchFacebook-E");
      this.branchInstagramE = document.getElementById("branchInstagram-E");
      this.branchTwitterE = document.getElementById("branchTwitter-E");
      this.branchLinkedinE = document.getElementById("branchLinkedin-E");
      this.primeryBranchE = document.getElementById("primeryBranch-E");
    },

    // ---------- Bind all events / triggers ----------
    bindEvents() {
      const self = this;

      // CREATE PRODUCT (use submit instead of inline onclick)
      if (this.productFormCreate && this.productCreateBtn) {
        this.productCreateBtn.addEventListener("click", function () {
          self.handleCreateProduct();
        });

        this.addProductModalEl.addEventListener("hidden.bs.modal", function () {
          self.productFormCreate.reset();
          self.productCreateBtn.innerHTML =
            '<i class="fas fa-plus me-2"></i>Add Product';
          self.productCreateBtn.disabled = false;
        });
      }

      // CREATE BRANCH
      if (this.branchFormCreate && this.branchCreateBtn) {
        this.branchCreateBtn.addEventListener("click", function () {
          self.handleCreateBranch();
        });

        this.addBranchModalEl.addEventListener("hidden.bs.modal", function () {
          self.branchFormCreate.reset();
          self.branchCreateBtn.innerHTML =
            '<i class="fas fa-plus me-2"></i>Add Branch';
          self.branchCreateBtn.disabled = false;
        });
      }

      // EDIT / DELETE (Products & Branches) â€“ using event delegation
      document.body.addEventListener("click", function (e) {
        const editProductBtn = e.target.closest(".edit-product-btn");
        const deleteProductBtn = e.target.closest(".delete-product-btn");
        const editBranchBtn = e.target.closest(".edit-branch-btn");
        const deleteBranchBtn = e.target.closest(".delete-branch-btn");

        if (editProductBtn) {
          const productId = editProductBtn.dataset.productId;
          self.loadProductIntoModal(productId);
        }

        if (deleteProductBtn) {
          const productId = deleteProductBtn.dataset.productId;
          self.deleteProduct(productId, deleteProductBtn);
        }

        if (editBranchBtn) {
          const branchId = editBranchBtn.dataset.branchId;
          self.loadBranchIntoModal(branchId);
        }

        if (deleteBranchBtn) {
          const branchId = deleteBranchBtn.dataset.branchId;
          self.deleteBranch(branchId, deleteBranchBtn);
        }
      });

      // SAVE EDITED PRODUCT
      if (this.productFormEdit) {
        this.productFormEdit.addEventListener("submit", function (e) {
          e.preventDefault();
          self.saveEditedProduct();
        });
      }

      // SAVE EDITED BRANCH
      if (this.branchEditForm) {
        this.branchEditForm.addEventListener("submit", function (e) {
          e.preventDefault();
          self.saveEditedBranch();
        });

        this.branchEditModalEl.addEventListener("hidden.bs.modal", function () {
          self.branchEditForm.reset();
          self.branchIdField.value = "";
          if (self.primeryBranchE) self.primeryBranchE.checked = false;
        });
      }
    },

    // ================== PRODUCT FUNCTIONS ==================

    async handleCreateProduct() {
      const form = this.productFormCreate;
      const btn = this.productCreateBtn;

      if (!form || !btn) return;

      const formData = new FormData(form);
      setButtonLoading(btn, true, "Adding...");

      try {
        const data = await apiRequest("/api/create-product/", {
          method: "POST",
          body: formData,
          isForm: true,
        });

        // Adjust condition according to your backend
        if (data.id || data.success) {
          btn.innerHTML = '<i class="fas fa-check me-2"></i>Success!';
          successThenReload(this.addProductModal);
        } else {
          throw new Error(JSON.stringify(data));
        }
      } catch (err) {
        alert("Error creating product: " + err.message);
        setButtonLoading(btn, false);
      }
    },

    async loadProductIntoModal(productId) {
      try {
        const data = await apiRequest(`/products/api/${productId}/`);

        this.productIdField.value = data.id;
        this.productNameE.value = data.name || "";
        this.productDescE.value = data.description || "";
        this.productQtyE.value = data.quantity_available ?? "";
        this.productPriceE.value = data.price ?? "";
        this.showPriceE.checked = !!data.show_price;
        this.showQuantityE.checked = !!data.show_quantity;
        this.placeOrdersE.checked = !!data.place_orders;

        if (data.image_url) {
          this.productImagePreview.src = data.image_url;
          this.productImagePreview.classList.remove("d-none");
        } else {
          this.productImagePreview.src = "";
          this.productImagePreview.classList.add("d-none");
        }

        this.productModal.show();
      } catch (err) {
        console.error("Error loading product:", err);
        alert("Failed to load product data.");
      }
    },

    async saveEditedProduct() {
      const productId = this.productIdField.value;
      const url = `/products/api/${productId}/`;
      const formData = new FormData(this.productFormEdit);

      try {
        const data = await apiRequest(url, {
          method: "POST", // use "PUT" if your API is RESTful
          body: formData,
          isForm: true,
        });

        // Adjust condition based on your API
        if (data.success || data.id) {
          successThenReload(this.productModal);
        } else {
          alert("Failed to save product.");
        }
      } catch (err) {
        console.error("Error saving product:", err);
        alert("Error saving product: " + err.message);
      }
    },

    async deleteProduct(productId, deleteBtn) {
      if (!confirm("Are you sure you want to delete this product?")) return;

      try {
        const data = await apiRequest(`/products/api/${productId}/delete/`, {
          method: "POST", // or "DELETE"
        });

        if (data.success) {
          const row = deleteBtn.closest("tr");
          if (row) row.remove();
        } else {
          alert("Failed to delete product.");
        }
      } catch (err) {
        console.error("Error deleting product:", err);
        alert("Error deleting product: " + err.message);
      }
    },

    // ================== BRANCH FUNCTIONS ==================

    async handleCreateBranch() {
      const form = this.branchFormCreate;
      const btn = this.branchCreateBtn;

      if (!form || !btn) return;

      const formData = new FormData(form);
      formData.set("primery_branch", form.primery_branch.checked);

      setButtonLoading(btn, true, "Adding...");

      try {
        const data = await apiRequest("/api/create-branch/", {
          method: "POST",
          body: formData,
          isForm: true,
        });

        if (data.id || data.success) {
          btn.innerHTML = '<i class="fas fa-check me-2"></i>Success!';
          successThenReload(this.addBranchModal);
        } else {
          throw new Error(JSON.stringify(data));
        }
      } catch (err) {
        alert("Error creating branch: " + err.message);
        setButtonLoading(btn, false);
      }
    },

    async loadBranchIntoModal(branchId) {
      try {
        const data = await apiRequest(`/branches/api/${branchId}/`);

        this.branchIdField.value = data.id;
        this.branchNameE.value = data.name || "";
        this.branchPhoneE.value = data.phone_number || "";
        this.branchEmailE.value = data.Email_Adress || "";
        this.branchAddressE.value = data.address || "";
        this.branchLatitudeE.value = data.latitude ?? "";
        this.branchLongitudeE.value = data.longitude ?? "";
        this.branchOpeningE.value = data.opening_hours || "";
        this.branchClosingE.value = data.closing_hours || "";
        this.branchDayFromE.value = data.day_from || "";
        this.branchDayToE.value = data.day_to || "";
        this.branchFacebookE.value = data.facbook_link || "";
        this.branchInstagramE.value = data.instagram_link || "";
        this.branchTwitterE.value = data.twitter_link || "";
        this.branchLinkedinE.value = data.linkdin_link || "";
        this.primeryBranchE.checked = !!data.primery_branch;

        this.branchEditModal.show();
      } catch (err) {
        console.error("Error loading branch:", err);
        alert("Failed to load branch data.");
      }
    },

    async saveEditedBranch() {
      const branchId = this.branchIdField.value;
      const url = `/branches/api/${branchId}/`;
      const formData = new FormData(this.branchEditForm);
      formData.set("primery_branch", this.primeryBranchE.checked);

      try {
        const data = await apiRequest(url, {
          method: "POST", // or PUT
          body: formData,
          isForm: true,
        });

        if (data.success || data.id) {
          successThenReload(this.branchEditModal);
        } else {
          alert("Failed to save branch.");
        }
      } catch (err) {
        console.error("Error saving branch:", err);
        alert("Error saving branch: " + err.message);
      }
    },

    async deleteBranch(branchId, deleteBtn) {
      if (!confirm("Are you sure you want to delete this branch?")) return;

      try {
        const data = await apiRequest(`/branches/api/${branchId}/delete/`, {
          method: "POST", // or DELETE
        });

        if (data.success) {
          const row = deleteBtn.closest("tr");
          if (row) row.remove();
        } else {
          alert("Failed to delete branch.");
        }
      } catch (err) {
        console.error("Error deleting branch:", err);
        alert("Error deleting branch: " + err.message);
      }
    },
  };

  // ================== INIT ==================
  document.addEventListener("DOMContentLoaded", function () {
    Dashboard.init();
  });
</script>

<style>
  .dashboard-container {
    padding: 1rem 0;
  }

  .dashboard-header {
    border-bottom: 1px solid #e2e8f0;
    padding-bottom: 1.5rem;
  }

  .stats-card {
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease;
  }

  .stats-card:hover {
    transform: translateY(-5px);
  }

  .stats-icon {
    font-size: 2.5rem;
    margin-right: 1rem;
    opacity: 0.8;
  }

  .stats-number {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .stats-label {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0;
  }

  .dashboard-section {
    background: transparent;
  }

  .section-header {
    padding-bottom: 0.5rem;
  }

  .section-title {
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 0;
  }

  .modal-content {
    border-radius: 20px !important;
  }
  .modern-modal .modal-content {
    /*border-radius: 20px !important;*/
    border: none;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  }

  .modern-modal .modal-header {
    /*border-radius: 20px 20px 0 0;*/
    padding: 1.5rem;
  }

  .modern-modal .modal-body {
    padding: 1.5rem;
  }

  .product-thumbnail {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
  }

  .no-image-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px dashed #dee2e6;
  }

  .user-avatar {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .table th {
    border-top: none;
    font-weight: 600;
    color: var(--secondary);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .table td {
    vertical-align: middle;
    padding: 1rem 0.75rem;
  }

  .btn-success-modern {
    background: linear-gradient(135deg, var(--success), #0ca678);
    color: white;
  }

  .btn-success-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    color: white;
  }

  .form-floating > .form-control:focus ~ label,
  .form-floating > .form-control:not(:placeholder-shown) ~ label {
    color: var(--primary);
  }

  .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.1);
  }

  @media (max-width: 768px) {
    .dashboard-header .text-md-end {
      text-align: left !important;
      margin-top: 1rem;
    }

    .stats-card {
      padding: 1rem;
    }

    .stats-icon {
      font-size: 2rem;
      margin-right: 0.75rem;
    }

    .stats-number {
      font-size: 1.5rem;
    }
  }
</style>
{% endblock %}
